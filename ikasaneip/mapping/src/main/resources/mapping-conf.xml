<?xml version="1.0" encoding="UTF-8"?>
<!--
 * $Id: mappingConfigurationService-context.xml 44074 2015-03-17 10:43:23Z stewmi $
 * $URL: https://svc-vcs-prd.uk.mizuho-sc.com:18080/svn/architecture/cmi2/trunk/projects/mappingConfigurationService/api/src/main/resources/mappingConfigurationService-context.xml $
 *
 * ====================================================================
 *
 * Copyright (c) 2000-2010 by Mizuho International plc.
 * All Rights Reserved.
 *
 * ====================================================================
 *
-->
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:aop="http://www.springframework.org/schema/aop"
    xmlns:tx="http://www.springframework.org/schema/tx"
    xmlns:util="http://www.springframework.org/schema/util"
    xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
       http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.0.xsd
       http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.0.xsd
       http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-2.5.xsd">

    <bean id="keyLocationQueryProcessorFactory" class="org.ikasan.mapping.keyQueryProcessor.KeyLocationQueryProcessorFactory">
        <constructor-arg ref="xaMappingConfigurationDao"/>
        <constructor-arg ref="keyLocationProcessorMap"/>
    </bean>

    <util:map id="keyLocationProcessorMap">
        <entry key="org.ikasan.mapping.keyQueryProcessor.impl.XPathKeyLocationQueryProcessor" 
            value-ref="xpathKeyLocationQueryProcessor"/>
    </util:map>

    <bean id="xpathKeyLocationQueryProcessor" 
        class="org.ikasan.mapping.keyQueryProcessor.impl.XPathKeyLocationQueryProcessor"/>

    <bean id="xaMappingConfigurationService" class="org.ikasan.mapping.service.MappingConfigurationServiceImpl">
        <constructor-arg ref="xaMappingConfigurationDao"/>
        <constructor-arg ref="keyLocationQueryProcessorFactory"/>
    </bean>

    <bean id="xaMappingConfigurationDao" class="org.ikasan.mapping.dao.HibernateMappingConfigurationDao">
        <property name="sessionFactory" ref="xaIkasanSessionFactory" />
    </bean>

    <bean id="xaIkasanSessionFactory"
        class="org.springframework.orm.hibernate4.LocalSessionFactoryBean">
        <property name="dataSource" ref="ikasan.xads" />
        <property name="mappingResources">
           <list>
               <value>/org/ikasan/mapping/model/ConfigurationContext.hbm.xml</value>
               <value>/org/ikasan/mapping/model/MappingConfiguration.hbm.xml</value>
               <value>/org/ikasan/mapping/model/MappingConfigurationLite.hbm.xml</value>
               <value>/org/ikasan/mapping/model/ConfigurationServiceClient.hbm.xml</value>
               <value>/org/ikasan/mapping/model/ConfigurationType.hbm.xml</value>
               <value>/org/ikasan/mapping/model/KeyLocationQuery.hbm.xml</value>
               <value>/org/ikasan/mapping/model/SourceConfigurationValue.hbm.xml</value>
               <value>/org/ikasan/mapping/model/TargetConfigurationValue.hbm.xml</value>
               <value>/org/ikasan/mapping/model/SourceConfigurationGroupSequence.hbm.xml</value>
               <value>/org/ikasan/mapping/model/PlatformConfiguration.hbm.xml</value>
           </list>
        </property>
        <property name="hibernateProperties" ref="platformHibernateProperties"/>
    </bean>

    <bean id="localTxMappingConfigurationService" class="org.ikasan.mapping.service.MappingConfigurationServiceImpl">
        <constructor-arg ref="localTxMappingConfigurationDao"/>
        <constructor-arg ref="keyLocationQueryProcessorFactory"/>
    </bean>

    <bean id="localTxMappingConfigurationDao" class="org.ikasan.mapping.dao.HibernateMappingConfigurationDao">
        <property name="sessionFactory" ref="localTxIkasanSessionFactory" />
    </bean>

    <bean id="localTxIkasanSessionFactory"
        class="org.springframework.orm.hibernate4.LocalSessionFactoryBean">
        <property name="dataSource" ref="ikasan.ds" />
        <property name="mappingResources">
           <list>
               <value>/org/ikasan/mapping/model/ConfigurationContext.hbm.xml</value>
               <value>/org/ikasan/mapping/model/MappingConfiguration.hbm.xml</value>
               <value>/org/ikasan/mapping/model/MappingConfigurationLite.hbm.xml</value>
               <value>/org/ikasan/mapping/model/ConfigurationServiceClient.hbm.xml</value>
               <value>/org/ikasan/mapping/model/ConfigurationType.hbm.xml</value>
               <value>/org/ikasan/mapping/model/KeyLocationQuery.hbm.xml</value>
               <value>/org/ikasan/mapping/model/SourceConfigurationValue.hbm.xml</value>
               <value>/org/ikasan/mapping/model/TargetConfigurationValue.hbm.xml</value>
               <value>/org/ikasan/mapping/model/SourceConfigurationGroupSequence.hbm.xml</value>
               <value>/org/ikasan/mapping/model/PlatformConfiguration.hbm.xml</value>
           </list>
        </property>
        <property name="hibernateProperties" ref="platformHibernateProperties"/>
    </bean>

</beans>